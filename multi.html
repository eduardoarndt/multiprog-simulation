<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">

    <style>
        #full {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            overflow-x: hidden;
        }

        .txt-header {
            text-align: center;
            flex: 1;
        }

        .txt-title {
            font-style: normal;
            font-weight: 600;
            margin: 10px;
        }

        .txt-lista {
            text-align: left;
            font-size: 12px;
            line-height: 1.1;
        }

        .full-height-screen {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        .full-height {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        .list-block {
            display: block;
        }
    </style>

    <title>Multiprogramação - Eduardo Arndt</title>
</head>

<body>
    <div id="full">
        <div class="container-fluid" style="text-align: center; padding: 10px;">
            <h1>Multiprogramação - Eduardo Arndt</h1>
        </div>

        <div class="container-fluid full-height-screen">
            <div class="container-fluid full-height" style="display: flex; flex-direction: row;">
                <div class="txt-header list-block" style="background-color: lightblue;">
                    <div class="txt-title">Criação</div>
                    <ol id="creation" class="txt-lista">
                        <!-- javascript controla itens aqui dentro -->
                    </ol>
                </div>
                <div class="txt-header list-block" style="background-color: lightcoral;">
                    <div class="txt-title">Apto</div>
                    <ul id="ready" class="txt-lista">
                        <!-- javascript controla itens aqui dentro -->
                    </ul>
                </div>
                <div class="txt-header list-block" style="background-color: lightyellow;">
                    <div class="txt-title">Execução</div>
                    <ul id="running" class="txt-lista">
                        <!-- javascript controla itens aqui dentro -->
                    </ul>
                </div>
                <div class="txt-header list-block" style="background-color: lightgreen;">
                    <div class="txt-title">Bloqueado</div>
                    <ul id="block" class="txt-lista">
                        <!-- javascript controla itens aqui dentro -->
                    </ul>
                </div>
                <div class="txt-header list-block" style="background-color: lightsteelblue;">
                    <div class="txt-title">Finalizado</div>
                    <ul id="exit" class="txt-lista">
                        <!-- javascript controla itens aqui dentro -->
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

    <script>

        class Process {
            constructor(processId, processName, processCycles) {
                this.id = processId;
                this.nome = processName;
                this.qtCiclos = processCycles;
            }
        }

        //controla execução do programa
        var executar = true;
        //gerador de ids para processos... só usar $idProcesso++;
        var idProcesso = 0;
        //ciclos que se passaram;
        var ciclos = 0;
        //arrays de estados
        var creation = new Array();
        var ready = new Array();
        var running = new Array();
        var blocked = new Array();
        var exit = new Array();
        //filas de dispositivos de entrada/saida...
        var filaHD = new Array();
        var filaVideo = new Array();
        var filaPrinter = new Array();
        //todos processos
        var todosProcessos = new Array();
        //maximo de ciclos que um processo pode ficar no processador...
        var maxCiclos = 30;
        //TODO: ler quantidade de processos: maximo 200;
        var qtProcessos = 200;
        //TODO: ler tempo de espera  em segundos;
        var tempoEspera = 3;

        for (let i = 0; i < qtProcessos; i++) {
            todosProcessos[i] = new Process(
                idProcesso++,                                                   //id
                "Processo" + "-" + Math.random().toString(36).substr(2, 5),     //nome
                getRandomInt(50, 200)                                           //qt ciclos
            )
        }

        function sleep(delay) {
            var start = new Date().getTime();
            while (new Date().getTime() < start + delay);
        }

        function atualizar() {

            var creationList = document.getElementById("creation");

            while (creationList.firstChild) {
                creationList.removeChild(creationList.firstChild);
            }

            creation.forEach(element => {
                var node = document.createElement("LI");
                var textnode = document.createTextNode(element['nome']);
                node.appendChild(textnode);
                creationList.appendChild(node);
            });

            //listar aptos
            //listar execucao
            //listar bloqueados
            //listar finalizados
        }

        function getRandomInt(min, max) {
            min = Math.ceil(min);
            max = Math.floor(max);
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        //começar execucao do programa... loopin'Dirty

        todosProcessos.forEach(element => {
            creation.push(element);
        });

        atualizar();

        throw 'teste';

        while (executar == true) {

            creation.forEach(element => {
                ready.push(element);
            });

            creation = [];

            ciclos++;

            if (todosProcessos.length < 200) {
                criarNovo = getRandomInt(0, 100);
                if ((criarNovo >= 0) && (criarNovo <= 10)) {
                    creation.push(new Process(
                        idProcesso++,
                        "Processo" + "-" + Math.random().toString(36).substr(2, 5),
                        getRandomInt(50, 200)
                    ));
                }
            }

            if (running.length < 1) {
                running.push(ready[0]);
                ready.shift();

                ciclar = 0;

                if (running[0].qtCiclos > 30) {
                    ciclar = 30;
                } else {
                    ciclar = running[0].qtCiclos;
                }

                for (let i = 0; i < ciclar; i++) {
                    running[0].qtCiclos--;
                }
            }

            executar = false;
            //TODO: Fim do programa
            if (exit.length == todosProcessos.length) {
                executar = false;
            }
        }

        atualizar();

        console.log('creation: ', creation);
        console.log('ready: ', ready);
        console.log('running: ', running);
        console.log('blocked: ', blocked);
        console.log('exit: ', exit);

        throw "STACK OVERFLOW! Just kidding, its just the end of the program";

    </script>
</body>

</html>